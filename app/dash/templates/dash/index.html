{% extends 'dash/base.html' %}
{% block title %}
    Dashboard
{% endblock %}
{% block main %}
    <div class="row">
        <div class="col-md-2 d-print-none">
            <div id="dateTabList" class="nav flex-column nav-pills" role="tablist" aria-orientation="vertical">
                {% for moment in test_moments %}
                    <a class="nav-link" id="date-{{ moment.id | slugify }}-tab" role="tab"
                       href="#date-{{ moment.id | slugify }}" data-tm-id="{{ moment.id }}"
                       data-toggle="pill">{{ moment.date }} ({{ moment.location }})</a>
                {% endfor %}
            </div>
        </div>
        <div class="col-md-10">
            <div class="tab-content">
                <div id="student-list"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    {% load static %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.4.2/handlebars.min.js"
            integrity="sha256-oh7N5nthuhldTk8/34Za7FXv3BkeVN9vAnYk/pLfC78=" crossorigin="anonymous"></script>
    <script>
        function removeTrailingSlash(str) {
            return str.replace(/\/$/, "");
        }
        window.history.replaceState(null, null, removeTrailingSlash(location.pathname) + location.hash);

        $(function () {
            $.get('{% static 'dash/templates/appointments.hbs' %}', function (data) {
                var template = Handlebars.compile(data);

                $('a[data-toggle="pill"]').on("shown.bs.tab", function () {
                    location.hash = `date-${$(this).data('tm-id')}`;

                    document.getElementById('student-list').innerHTML = "<div class=\"d-flex justify-content-center\">\n" +
                        "  <div class=\"spinner-border\" role=\"status\">\n" +
                        "    <span class=\"sr-only\">Loading...</span>\n" +
                        "  </div>\n" +
                        "</div>";
                    $.get(`/api/appointments/${$(this).data('tm-id')}`, function (data) {
                        document.getElementById('student-list').innerHTML = template(data);
                    });
                });

                if (location.hash) {
                    $(`a[href="${location.hash}"]`).tab('show')
                } else {
                    $('#dateTabList a:first-child').tab('show')
                }
            });

        });
    </script>
{% endblock %}